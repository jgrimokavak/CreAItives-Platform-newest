
Problem
-------
The server runs as an ES‑module (`"type":"module"` in package.json), so the CommonJS global `__dirname` is **undefined**. `server/routes.ts` (and possibly other files) still reference `__dirname`, causing Express to throw and respond:

500  { "message": "__dirname is not defined" }

Solution
--------
In every file that needs `__dirname` add this snippet right after imports:

```ts
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname  = path.dirname(__filename);
```

After that you can use `__dirname` normally.

Steps for the agent
-------------------
1. Edit `server/routes.ts` (and any other module using `__dirname`).
2. Insert the snippet above immediately after existing imports.
3. Remove obsolete fallback comments.
4. Restart the server (`npm run dev`).

Result
------
`/api/edit-image` should respond 200 with edited images; the 500 error disappears.
