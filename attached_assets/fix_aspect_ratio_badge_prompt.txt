fix_aspect_ratio_badge_prompt.txt
===============================

Objective:
Ensure each ImageCard displays the correct aspect‑ratio badge (e.g. “16:9”) without visual distortion or dynamic `aspect-*` CSS side‑effects.

1. Add canonical `aspectRatio` field to Prisma schema
   - Open `prisma/schema.prisma`.
   - In the `Image` model, insert:
     ```prisma
     aspectRatio String @default("1:1")
     ```
   - Run:
     ```
     npx prisma migrate dev --name add_aspect_ratio
     ```

2. Persist `aspectRatio` in all generation workers
   - **GPT‑Image‑1**: after generation, derive ratio from `size`:
     ```ts
     const ratioMap: Record<string, string> = {
       "1024x1024": "1:1",
       "1024x1792": "9:16",
       "1792x1024": "16:9"
     };
     data.aspectRatio = ratioMap[data.size] ?? "1:1";
     ```
   - **Imagen‑3 / Flux‑Pro**: forward the selected `aspect_ratio` directly.
   - Save the record with `aspectRatio` field.

3. Backfill existing rows (one‑off script)
   ```ts
   await prisma.image.updateMany({
     data: {
       aspectRatio: prisma.sql`
         CASE
           WHEN size = '1024x1792' THEN '9:16'
           WHEN size = '1792x1024' THEN '16:9'
           ELSE '1:1'
         END`
     }
   });
   ```

4. Update ImageCard badge rendering
   - Open `components/ImageCard.tsx`.
   - Replace the badge code with:
     ```tsx
     {image.aspectRatio && (
       <Badge className="whitespace-nowrap bg-muted/60">
         {image.aspectRatio}
       </Badge>
     )}
     ```
   - **Remove** any `className={\`aspect-${...}\`}` usage.

5. Clean up legacy CSS
   - Search codebase for `aspect-16/9`, `aspect-9/16`, `aspect-4/3`, etc.
   - Delete related unused utility classes in `tailwind.config.js` if previously added.

Testing
- Generate one image in each available ratio via Create page, then open Gallery; confirm each card shows “1:1”, “16:9”, “9:16”, etc., with no stretched pills.
- Resize browser to mobile and desktop widths; badges remain compact with `whitespace-nowrap`.
- Inspect DOM: ensure no `aspect-*` classes on badge elements.

Reminders & Constraints
- Do not alter the existing visual theme or Tailwind color scheme.
- Ensure `aspectRatio` is always set; fall back to “1:1” if unknown.
- Keep the Prisma migration compatible with production data.
